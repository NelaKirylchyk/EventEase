@page "/events/{name}"
@using Microsoft.AspNetCore.Components
@using EventEase.Models
@using EventEase.Services
@inject IEventsState EventsState
@inject IAttendanceTracker Attendance

<PageTitle>Event Details</PageTitle>
<h1>Event Details</h1>

@if (Event is null)
{
    <p class="text-danger">Event not found.</p>
}
else
{
    <EventCard Name="@Event.Name" Date="@Event.Date" Location="@Event.Location" />
    <div class="mt-3">
        <NavLink class="btn btn-success" href="@($"/register/{Uri.EscapeDataString(Event.Name)}")">Register</NavLink>
        <button class="btn btn-outline-primary ms-2" @onclick="CheckIn">Check-in</button>
        <NavLink class="btn btn-secondary ms-2" href="/events">Back to Events</NavLink>
    </div>
    <div class="mt-3">
        <strong>Attendance:</strong>
        <div>Registered: @Attendance.Get(Event.Name).RegisteredCount</div>
        <div>Checked-in: @Attendance.Get(Event.Name).CheckedInCount</div>
    </div>
}

@code {
    [Parameter] public string? name { get; set; }

    private EventItem? Event;

    protected override void OnParametersSet()
    {
        Event = EventsState.FindByName(name);
    }

    private void CheckIn()
    {
        if (Event is null) return;
        Attendance.CheckIn(Event.Name);
    }
}